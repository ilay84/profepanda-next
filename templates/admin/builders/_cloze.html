{# templates/admin/builders/_cloze.html #}
<form id="ex-cloze-form"
      class="tiny"
      action="{{ url_for('admin.admin_exercises_save') }}"
      method="post"
      enctype="multipart/form-data"
      style="margin-top:.25rem;">

  <input type="hidden" name="type" value="cloze">
  {% if edit_ex and edit_ex.id %}
    <input type="hidden" name="id" value="{{ edit_ex.id }}">
  {% endif %}
  <!-- Will be filled with JSON on submit by builder_cloze.js -->
  <textarea id="clozeItemsPayload" name="items" style="display:none;"></textarea>

  <div style="display:flex;flex-direction:column;gap:.75rem;max-width:900px;">
    <label><strong>Título del ejercicio</strong>
      <input name="title"
             type="text"
             required
             placeholder="Ej.: SER en contexto — Completar huecos (A2)"
             style="width:100%;padding:.6rem;border:1px solid #cbd5e1;border-radius:8px;">
    </label>

    <!-- NEW: Optional instructions -->
    <label><strong>Instrucciones (opcional)</strong>
      <textarea name="instructions" id="instructionsField"
                placeholder="Ej.: Completá las oraciones con la forma correcta del verbo SER."
                style="width:100%;min-height:100px;padding:.6rem;border:1px solid #cbd5e1;border-radius:8px;line-height:1.5;font-family:inherit;"></textarea>
      <div class="tiny muted" style="margin-top:.25rem;">
        Podés usar <b>&lt;b&gt;</b> para negrita o <i>&lt;i&gt;</i> para cursiva.
      </div>
    </label>

    <!-- Items builder (Cloze) - the JS will populate this -->
    <div>
      <div class="row" style="justify-content:space-between;align-items:center;">
        <div class="muted" style="font-weight:600;">Preguntas (Completar huecos)</div>
      </div>
      <div id="clozeItemsList"
           style="display:flex;flex-direction:column;gap:.75rem;margin-top:.75rem;"></div>
      <div class="row" style="margin-top:.5rem;justify-content:flex-end;">
        <button type="button" id="btnAddClozeItem" class="btn">+ Agregar oración</button>
      </div>
    </div>

    <div class="row">
      <button class="btn btn-primary" type="submit">Guardar versión</button>
      <button class="btn btn-secondary" type="button" id="btnCancelCloze">Cancelar</button>
      <span class="tiny muted">Se guardará en <code>data/exercises/</code> y se actualizará <code>exercises.index.json</code>.</span>
    </div>
  </div>
</form>